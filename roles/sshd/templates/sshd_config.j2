# ============================================================ #
# Auto-generated by Ansible                                    #
# Do not edit manually! Changes will be overwritten.           #
# ============================================================ #

{# Включение конфигов из директории #}
Include /etc/ssh/sshd_config.d/*.conf

{# Базовые настройки #}
Port {{ ssh_config.port | default(22) }}

HostKey /etc/ssh/ssh_host_rsa_key
HostKey /etc/ssh/ssh_host_ecdsa_key
HostKey /etc/ssh/ssh_host_ed25519_key

{# Настройки логирования #}
SyslogFacility AUTH
LogLevel {{ ssh_config.log_level | default('INFO') }}

{# Настройки аутентификации #}
LoginGraceTime {{ ssh_config.login_grace_time | default('45s') }}
PermitRootLogin {{ ssh_config.permit_root_login | default('no') }}
StrictModes {{ ssh_config.strict_mode | default('yes') }}
MaxAuthTries {{ ssh_config.max_auth_tries | default(6) }}
MaxSessions {{ ssh_config.max_sessions | default(10) }}

{# Настройки публичного ключа #}
PubkeyAuthentication {{ ssh_config.pubkey_authentication | default('yes') }}
AuthorizedKeysFile .ssh/authorized_keys .ssh/authorized_keys2

{# Настройки парольной аутентификации #}
PasswordAuthentication {{ ssh_config.password_authentication | default('yes') }}
PermitEmptyPasswords no
ChallengeResponseAuthentication no
KbdInteractiveAuthentication {{ ssh_config.interactive_authentication | default('yes') }}

{# Методы аутентификации #}
AuthenticationMethods {{ ssh_config.authentication_methods | default('password') }}

{# Настройки безопасности #}
UsePAM {{ ssh_config.use_pam | default('yes') }}
AllowTcpForwarding {{ ssh_config.allow_tcp_forwarding | default('yes') }}
AllowAgentForwarding {{ ssh_config.allow_agent_forwarding | default('yes') }}
X11Forwarding {{ ssh_config.x11_forwarding | default('no') }}
PrintMotd no
PrintLastLog {{ ssh_config.print_last_log | default('yes') }}
TCPKeepAlive {{ ssh_config.tcp_keep_alive | default('no') }}

{# Настройки keepalive #}
ClientAliveInterval {{ ssh_config.client_alive_interval | default(600) }}
ClientAliveCountMax {{ ssh_config.client_alive_count_max | default(10) }}

{# Настройки лимитов #}
MaxStartups {{ ssh_config.max_startups | default('10:30:60') }}

{# Переменные окружения #}
AcceptEnv LANG LC_*

{# Подсистема SFTP #}
Subsystem sftp /usr/lib/openssh/sftp-server
